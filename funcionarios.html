<script>

if(localStorage.getItem("logado")!=="sim"){
location="login.html"
}

let funcionarios = []

/* ============================= */
/* CARREGAR FUNCIONÁRIOS DO BANCO */
/* ============================= */
async function carregarFuncionarios(){

const { data, error } = await supabaseClient
.from("funcionarios")
.select("*")
.order("nome",{ascending:true})

if(error){
alert("Erro ao carregar funcionários")
console.error(error)
return
}

funcionarios = data
renderTabela()
}

/* ============================= */
/* RENDERIZAR TABELA */
/* ============================= */
function renderTabela(){

const lista = document.getElementById("listaFuncionarios")
lista.innerHTML=""

funcionarios.forEach((f,i)=>{

lista.innerHTML += `
<tr>
<td>${f.nome || ""}</td>
<td>${f.cpf || ""}</td>
<td>${f.cargo || ""}</td>
<td>${f.setor || ""}</td>

<td class="acoes">

<button class="btn-ver" onclick="ver(${i})">Ver</button>
<button class="btn-editar" onclick="editar(${i})">Editar</button>
<button class="btn-contra" onclick="contracheque(${i})">Contracheque</button>
<button class="btn-excluir" onclick="excluir(${i})">Excluir</button>

</td>
</tr>
`
})

}

/* ============================= */
/* VER FUNCIONÁRIO */
/* ============================= */
function ver(i){
localStorage.setItem("funcionarioSelecionado", funcionarios[i].id)
location="ficha.html"
}

/* ============================= */
/* EDITAR FUNCIONÁRIO */
/* ============================= */
function editar(i){
localStorage.setItem("funcionarioEditando", funcionarios[i].id)
location="ficha.html"
}

/* ============================= */
/* CONTRACHEQUE */
/* ============================= */
function contracheque(i){
localStorage.setItem("funcionarioSelecionado", funcionarios[i].id)
location="contracheque.html"
}

/* ============================= */
/* EXCLUIR FUNCIONÁRIO */
/* ============================= */
async function excluir(i){

if(!confirm("Excluir funcionário?")) return

const id = funcionarios[i].id

const { error } = await supabaseClient
.from("funcionarios")
.delete()
.eq("id", id)

if(error){
alert("Erro ao excluir")
console.error(error)
return
}

alert("Funcionário excluído com sucesso")
carregarFuncionarios()
}

/* ============================= */
/* INICIAR */
/* ============================= */
carregarFuncionarios()

</script>
