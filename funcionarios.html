<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Funcionários</title>
<link rel="stylesheet" href="style.css">

<style>

body{
background:#0f0f0f;
color:white;
font-family:Segoe UI, Arial;
}

.page{
max-width:1200px;
margin:40px auto;
padding:20px;
}

.top-bar{
display:flex;
gap:10px;
align-items:center;
margin-bottom:20px;
flex-wrap:wrap;
}

input, select{
padding:10px;
border-radius:6px;
border:none;
}

.tabela{
width:100%;
border-collapse:collapse;
background:#1b1b1b;
border-radius:8px;
overflow:hidden;
}

.tabela th{
background:#2a2a2a;
padding:12px;
text-align:left;
}

.tabela td{
padding:12px;
border-top:1px solid #333;
}

.tabela tr:hover{
background:#252525;
}

.acoes button{
margin-right:6px;
padding:6px 10px;
border:none;
border-radius:5px;
cursor:pointer;
font-size:12px;
}

.btn-ver{ background:#3498db; color:white }
.btn-editar{ background:#f39c12; color:black }
.btn-contra{ background:#2ecc71; color:black }
.btn-excluir{ background:#e74c3c; color:white }

.footer{
margin-top:20px;
display:flex;
justify-content:space-between;
}

</style>
</head>

<body>

<div class="page">

<div class="top-bar">
<h2>Funcionários</h2>

<input type="text" id="busca" placeholder="Buscar por nome ou CPF..." onkeyup="filtrar()">

<select id="filtroUnidade" onchange="filtrar()">
<option value="">Todas as unidades</option>
<option>Sabará</option>
<option>Ocidental</option>
<option>Águas Lindas</option>
<option>Cruzeiro da Fortaleza</option>
<option>Guimarânia</option>
</select>

</div>

<table class="tabela">
<thead>
<tr>
<th>Nome</th>
<th>CPF</th>
<th>Cargo</th>
<th>Setor</th>
<th style="width:250px">Ações</th>
</tr>
</thead>

<tbody id="listaFuncionarios"></tbody>
</table>

<div class="footer">
<button onclick="window.location='dashboard.html'">Voltar ao painel</button>
<div id="paginacao"></div>
</div>

</div>

<script>

/* ========================= */
/* PROTEÇÃO LOGIN */
/* ========================= */
if(localStorage.getItem("logado")!=="sim"){
window.location="login.html"
}

/* ========================= */
/* USUÁRIO LOGADO */
/* ========================= */
const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"))

let todosFuncionarios = JSON.parse(localStorage.getItem("funcionarios")) || []
let funcionarios = []

/* ========================= */
/* CONTROLE DE VISUALIZAÇÃO */
/* ========================= */

if(usuarioLogado.nome === "admin"){
funcionarios = todosFuncionarios
}else{
funcionarios = todosFuncionarios.filter(f => f.unidade === usuarioLogado.unidade)

/* esconder filtro para usuários comuns */
document.getElementById("filtroUnidade").style.display="none"
}

/* ========================= */
/* PAGINAÇÃO */
/* ========================= */

let paginaAtual = 1
const porPagina = 8

function mostrar(lista){

const inicio = (paginaAtual-1)*porPagina
const fim = inicio+porPagina
const pagina = lista.slice(inicio,fim)

let html=""

pagina.forEach(func=>{

const index = todosFuncionarios.indexOf(func)

html+=`
<tr>
<td>${func.nome || "-"}</td>
<td>${func.cpf || "-"}</td>
<td>${func.cargo || "-"}</td>
<td>${func.setor || "-"}</td>
<td class="acoes">
<button class="btn-ver" onclick="verFicha(${index})">Ver</button>
<button class="btn-editar" onclick="editar(${index})">Editar</button>
<button class="btn-contra" onclick="contra(${index})">Contracheque</button>
<button class="btn-excluir" onclick="excluir(${index})">Excluir</button>
</td>
</tr>`
})

listaFuncionarios.innerHTML=html
paginacaoCriar(lista.length)
}

/* ========================= */
/* FILTRO GERAL */
/* ========================= */

function filtrar(){

const termo = busca.value.toLowerCase()
const unidadeSelecionada = filtroUnidade.value

let lista = funcionarios

if(unidadeSelecionada){
lista = lista.filter(f => f.unidade === unidadeSelecionada)
}

lista = lista.filter(f =>
(f.nome||"").toLowerCase().includes(termo) ||
(f.cpf||"").includes(termo)
)

mostrar(lista)
}

/* ========================= */
/* PAGINAÇÃO */
/* ========================= */

function paginacaoCriar(total){
const paginas = Math.ceil(total/porPagina)
let html=""
for(let i=1;i<=paginas;i++){
html+=`<button onclick="irPagina(${i})">${i}</button>`
}
paginacao.innerHTML=html
}

function irPagina(p){
paginaAtual=p
filtrar()
}

/* ========================= */
/* AÇÕES */
/* ========================= */

function verFicha(i){
localStorage.setItem("funcionarioSelecionado",i)
window.open("ficha.html","_blank")
}

function editar(i){
localStorage.setItem("funcionarioEditando",i)
window.open("ficha.html","_blank")
}

function contra(i){
localStorage.setItem("funcionarioSelecionado",i)
window.location="contracheque.html"
}

function excluir(i){
if(confirm("Excluir funcionário?")){
todosFuncionarios.splice(i,1)
localStorage.setItem("funcionarios",JSON.stringify(todosFuncionarios))
filtrar()
}
}

/* iniciar */
mostrar(funcionarios)

</script>

</body>
</html>
