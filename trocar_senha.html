<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Primeiro acesso</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">

<h1>Primeiro acesso</h1>
<p>Você deve criar uma nova senha.</p>

<input type="password" id="senha1" placeholder="Nova senha">
<input type="password" id="senha2" placeholder="Confirmar senha">

<br><br>

<button onclick="salvar()">Salvar nova senha</button>

</div>

<script>

if(localStorage.getItem("logado")!=="sim"){
window.location="login.html"
}

function salvar(){

const s1 = document.getElementById("senha1").value
const s2 = document.getElementById("senha2").value

if(!s1 || !s2){
alert("Preencha as duas senhas")
return
}

if(s1 !== s2){
alert("As senhas não coincidem")
return
}

let usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"))
let usuarios = JSON.parse(localStorage.getItem("usuarios")) || []

let usuario = usuarios.find(u => u.nome === usuarioLogado.nome)

if(!usuario){
usuario = {
nome: usuarioLogado.nome,
unidade: usuarioLogado.unidade || ""
}
usuarios.push(usuario)
}

usuario.senha = btoa(s1)
usuario.primeiroAcesso = false

localStorage.setItem("usuarios", JSON.stringify(usuarios))

usuarioLogado.senha = usuario.senha
usuarioLogado.primeiroAcesso = false
localStorage.setItem("usuarioLogado", JSON.stringify(usuarioLogado))

alert("Senha alterada com sucesso")
window.location="dashboard.html"

}

</script>

</body>
</html>
