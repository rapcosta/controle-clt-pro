<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Cadastro de Funcionário</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>
.container{
max-width:1000px;
margin:auto;
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
}
input,select{
padding:8px;
border-radius:6px;
border:none;
}
.full{ grid-column:span 2 }
h2{ grid-column:span 2; margin-top:20px }
</style>
</head>

<body>

<h1 id="titulo">Cadastro de Funcionário</h1>

<div class="container">

<!-- ================= DADOS PESSOAIS ================= -->
<h2>Dados Pessoais</h2>

<input id="nome" placeholder="Nome completo" class="full">
<input id="email" placeholder="Email">
<input id="celular" placeholder="Celular">
<input id="nascimento" type="date">
<input id="genero" placeholder="Gênero">
<input id="sangue" placeholder="Tipo sanguíneo">

<!-- ================= DOCUMENTOS ================= -->
<h2>Documentos</h2>

<input id="cpf" placeholder="CPF">
<input id="rg" placeholder="RG">
<input id="ctps" placeholder="CTPS">
<input id="nis" placeholder="NIS">

<!-- ================= PROFISSIONAL ================= -->
<h2>Dados Profissionais</h2>

<input id="funcao" placeholder="Função">
<input id="cbo" placeholder="CBO">
<input id="categoria" placeholder="Categoria código">
<input id="matricula" placeholder="Matrícula">
<input id="entrada" type="date">
<input id="horario" placeholder="Horário de trabalho">
<input id="atividades" placeholder="Atividades" class="full">

<!-- ================= EMPRESA ================= -->
<h2>Empresa</h2>

<input id="empresa" placeholder="Empresa">
<input id="cnpj" placeholder="CNPJ">

<select id="unidade" class="full">
<option value="">Selecionar unidade</option>
<option>Sabara</option>
<option>Cruzeiro da Fortaleza</option>
<option>Ocidental</option>
<option>Aguas Lindas</option>
<option>Guimarania</option>
</select>

<!-- ================= DADOS BANCÁRIOS ================= -->
<h2>Dados Bancários</h2>

<input id="banco" placeholder="Banco">
<input id="agencia" placeholder="Agência">
<input id="conta" placeholder="Conta">
<input id="pix" placeholder="Chave PIX" class="full">

<!-- ================= BOTÕES ================= -->
<button onclick="salvar()">Salvar</button>
<button onclick="voltar()">Cancelar</button>

</div>

<script>

if(localStorage.getItem("logado")!=="sim"){
location="login.html"
}

const uidEditar = localStorage.getItem("funcionarioEditando")

if(uidEditar){
titulo.innerText="Editar Funcionário"
carregar()
}

/* ================= CARREGAR PARA EDIÇÃO ================= */
async function carregar(){

const { data, error } = await supabaseClient
.from("funcionarios")
.select("*")
.eq("uid", uidEditar)
.single()

if(error){
alert("Erro ao carregar dados")
console.error(error)
return
}

Object.keys(data).forEach(campo=>{
const el=document.getElementById(campo)
if(el) el.value=data[campo]
})
}

/* ================= SALVAR ================= */
async function salvar(){

const funcionario={
nome:nome.value,
email:email.value,
celular:celular.value,
nascimento:nascimento.value,
genero:genero.value,
sangue:sangue.value,
cpf:cpf.value,
rg:rg.value,
ctps:ctps.value,
nis:nis.value,
funcao:funcao.value,
cbo:cbo.value,
categoria:categoria.value,
matricula:matricula.value,
entrada:entrada.value,
horario:horario.value,
atividades:atividades.value,
empresa:empresa.value,
cnpj:cnpj.value,
unidade:unidade.value,
banco:banco.value,
agencia:agencia.value,
conta:conta.value,
pix:pix.value
}

/* EDITAR */
if(uidEditar){

const { error } = await supabaseClient
.from("funcionarios")
.update(funcionario)
.eq("uid", uidEditar)

if(error){
alert("Erro ao atualizar")
console.error(error)
return
}

localStorage.removeItem("funcionarioEditando")
alert("Funcionário atualizado")
location="funcionarios.html"
return
}

/* NOVO */

const { error } = await supabaseClient
.from("funcionarios")
.insert([funcionario])

if(error){
alert("Erro ao cadastrar")
console.error(error)
return
}

alert("Funcionário cadastrado")
location="funcionarios.html"
}

function voltar(){
localStorage.removeItem("funcionarioEditando")
location="funcionarios.html"
}

</script>
</body>
</html>
