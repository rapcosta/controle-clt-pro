<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Cadastro de Funcionário</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>
.container{
max-width:900px;
margin:auto;
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
}
input,select{
padding:8px;
border-radius:6px;
border:none;
}
.full{ grid-column:span 2 }
</style>
</head>

<body>

<h1 id="titulo">Cadastro de Funcionário</h1>

<div class="container">

<input id="nome" placeholder="Nome completo" class="full">
<input id="email" placeholder="Email">
<input id="celular" placeholder="Celular">
<input id="nascimento" type="date">
<input id="genero" placeholder="Gênero">
<input id="sangue" placeholder="Tipo sanguíneo">

<input id="cpf" placeholder="CPF">
<input id="rg" placeholder="RG">
<input id="ctps" placeholder="CTPS">
<input id="nis" placeholder="NIS">

<input id="funcao" placeholder="Função">
<input id="cbo" placeholder="CBO">
<input id="categoria" placeholder="Categoria código">
<input id="matricula" placeholder="Matrícula">
<input id="entrada" type="date">
<input id="atividades" placeholder="Atividades" class="full">
<input id="horario" placeholder="Horário de trabalho">

<input id="empresa" placeholder="Empresa">
<input id="cnpj" placeholder="CNPJ">

<select id="unidade" class="full">
<option value="">Selecionar unidade</option>
<option>Sabará</option>
<option>Águas Lindas</option>
<option>Valparaíso</option>
</select>

<button onclick="salvar()">Salvar</button>
<button onclick="voltar()">Cancelar</button>

</div>

<script>

const uidEditar = localStorage.getItem("funcionarioEditando")

if(uidEditar){
titulo.innerText="Editar Funcionário"
carregar()
}

async function carregar(){

const { data } = await supabaseClient
.from("funcionarios")
.select("*")
.eq("uid",uidEditar)
.single()

if(!data) return

Object.keys(data).forEach(k=>{
const el=document.getElementById(k)
if(el) el.value=data[k]
})
}

async function salvar(){

const funcionario={
nome:nome.value,
email:email.value,
celular:celular.value,
nascimento:nascimento.value,
genero:genero.value,
sangue:sangue.value,
cpf:cpf.value,
rg:rg.value,
ctps:ctps.value,
nis:nis.value,
funcao:funcao.value,
cbo:cbo.value,
categoria:categoria.value,
matricula:matricula.value,
entrada:entrada.value,
atividades:atividades.value,
horario:horario.value,
empresa:empresa.value,
cnpj:cnpj.value,
unidade:unidade.value
}

if(uidEditar){

await supabaseClient
.from("funcionarios")
.update(funcionario)
.eq("uid",uidEditar)

localStorage.removeItem("funcionarioEditando")
alert("Atualizado")
location="funcionarios.html"
return
}

await supabaseClient
.from("funcionarios")
.insert([funcionario])

alert("Cadastrado")
location="funcionarios.html"
}

function voltar(){
location="funcionarios.html"
}

</script>
</body>
</html>
