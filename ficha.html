<script>

if(localStorage.getItem("logado")!=="sim"){
location="login.html"
}

/* pegar id correto */
const id =
localStorage.getItem("funcionarioEditando") ||
localStorage.getItem("funcionarioSelecionado")

if(!id){
alert("Funcionário não encontrado")
location="funcionarios.html"
}

/* ============================= */
/* CARREGAR FUNCIONÁRIO */
/* ============================= */
async function carregar(){

const { data, error } = await supabaseClient
.from("funcionarios")
.select("*")
.eq("uid", id)   // ← AQUI É O MAIS IMPORTANTE
.single()

if(error){
alert("Erro ao carregar funcionário")
console.error(error)
location="funcionarios.html"
return
}

mostrar(data)
}

function mostrar(f){

tituloNome.innerText = f.nome || ""
cpf.innerText = f.cpf || "-"
cargo.innerText = f.cargo || "-"
setor.innerText = f.setor || "-"
salario.innerText = "R$ " + Number(f.salario||0).toFixed(2)

}

/* ============================= */
/* EDITAR */
/* ============================= */
function editar(){

document.querySelectorAll(".valor").forEach(el=>{
const campo = el.id
const valor = el.innerText.replace("R$ ","")
el.innerHTML = `<input id="edit_${campo}" value="${valor}">`
})

btnSalvar.style.display="inline-block"
}

/* ============================= */
/* SALVAR */
/* ============================= */
async function salvar(){

const atualizacao = {}

document.querySelectorAll("[id^='edit_']").forEach(input=>{
const campo = input.id.replace("edit_","")
atualizacao[campo] = input.value
})

const { error } = await supabaseClient
.from("funcionarios")
.update(atualizacao)
.eq("uid", id)   // ← IMPORTANTE

if(error){
alert("Erro ao salvar")
console.error(error)
return
}

alert("Alterações salvas")
location.reload()
}

function voltar(){
location="funcionarios.html"
}

carregar()

</script>
