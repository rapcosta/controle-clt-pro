<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ficha Funcionário</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<link rel="stylesheet" href="style.css">
</head>

<body>

<button onclick="logout()">Sair</button>

<h2 id="nome"></h2>

<p>CPF: <span id="cpf"></span></p>
<p>Cargo: <span id="cargo"></span></p>
<p>Setor: <span id="setor"></span></p>
<p>Salário: <span id="salario"></span></p>

<button onclick="editar()">Editar</button>
<button onclick="voltar()">Voltar</button>

<script>

/* ================= UID ================= */
const uid = localStorage.getItem("funcionarioUID")

if(!uid){
alert("Funcionário não encontrado")
location="funcionarios.html"
}

/* ================= CARREGAR ================= */
async function carregar(){

const { data, error } = await supabaseClient
.from("funcionarios")
.select("*")
.eq("uid", uid)
.single()

if(error){
alert("Erro ao carregar funcionário")
console.error(error)
return
}

document.getElementById("nome").innerText = data.nome || ""
document.getElementById("cpf").innerText = data.cpf || ""
document.getElementById("cargo").innerText = data.cargo || ""
document.getElementById("setor").innerText = data.setor || ""
document.getElementById("salario").innerText = data.salario || ""
}

/* ================= AÇÕES ================= */

function editar(){
localStorage.setItem("funcionarioEditando", uid)
location="cadastro.html"
}

function voltar(){
location="funcionarios.html"
}

async function logout(){
await supabaseClient.auth.signOut()
location="login.html"
}

/* ================= INICIAR ================= */

carregar()

</script>

<!-- proteção login -->
<script src="auth.js"></script>
<script>
window.addEventListener("DOMContentLoaded", () => {
protegerPagina()
})
</script>


</body>
</html>
