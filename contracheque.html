<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Gerar Contracheque</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
    background:#000;
    color:#fff;
    font-family: Arial, Helvetica, sans-serif;
}

/* CONTAINER CENTRAL */
.container{
    width:100%;
    max-width:520px;
    margin:40px auto;
    padding:30px;
    background:rgba(20,20,20,0.9);
    border-radius:12px;
    box-shadow:0 0 20px rgba(0,0,0,0.6);
    text-align:center;
}

/* TITULOS */
h1{
    margin-bottom:10px;
}

h3{
    margin-top:25px;
    margin-bottom:10px;
}

/* LINHA SEPARADORA */
hr{
    margin:20px 0;
    border:1px solid #444;
}

/* GRUPOS DE CAMPOS */
.grupo{
    margin-bottom:18px;
    text-align:left;
}

/* LABEL */
label{
    display:block;
    margin-bottom:5px;
    font-weight:bold;
    font-size:14px;
}

/* INPUT */
input{
    width:100%;
    padding:12px;
    border-radius:8px;
    border:none;
    font-size:15px;
    background:#eee;
}

/* BOTÕES */
.botoes{
    margin-top:25px;
    display:flex;
    justify-content:center;
    gap:10px;
}

button{
    padding:12px 20px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:15px;
    background:#e0e0e0;
}

button:hover{
    background:#cfcfcf;
}

/* RESUMO */
.resumo{
    margin-top:25px;
    padding:20px;
    background:#111;
    border-radius:10px;
    text-align:left;
}

.resumo p{
    margin:6px 0;
}

</style>
</head>

<body>

<div class="container" id="area-contracheque">

<h1>Gerar Contracheque</h1>

<h3 id="nomeFuncionario"></h3>

<hr>

<label>Mês</label>
<input id="mes" value="01">

<label>Ano</label>
<input id="ano" value="2026">

<hr>

<h3>Vencimentos</h3>

<label>Salário Base (R$)</label>
<input id="salario_base">

<label>Horas Extras (R$)</label>
<input id="horas_extras" value="0">

<label>Adicional Noturno (R$)</label>
<input id="noturno" value="0">

<label>Insalubridade (R$)</label>
<input id="insalubridade" value="0">

<hr>

<h3>Descontos</h3>

<label>Faltas (dias)</label>
<input id="faltas" value="0">

<label>Dependentes IRRF</label>
<input id="dependentes" value="0">

<hr>

<button onclick="calcular()">Calcular</button>
<button onclick="gerarPDF()">Gerar PDF</button>
<button onclick="voltar()">Voltar</button>

<div class="resumo">
<h3>Resumo do cálculo</h3>

<p>Salário Base: R$ <span id="r_salario">0</span></p>
<p>Total Vencimentos: R$ <span id="r_vencimentos">0</span></p>
<p>INSS: R$ <span id="r_inss">0</span></p>
<p>FGTS: R$ <span id="r_fgts">0</span></p>
<p>Líquido: R$ <span id="r_liquido">0</span></p>
</div>

</div>

<script>

/* ============================= */
/* PEGAR UID */
/* ============================= */

const params = new URLSearchParams(window.location.search)
const uid = params.get("uid")

/* ============================= */
/* CARREGAR FUNCIONARIO */
/* ============================= */

async function carregarFuncionario(){

const {data,error} = await supabaseClient
.from("funcionarios")
.select("*")
.eq("uid", uid)
.single()

if(error){
alert("Erro ao carregar funcionário")
return
}

document.getElementById("nomeFuncionario").innerText =
data.nome + " | CPF: " + data.cpf

document.getElementById("salario_base").value = data.salario || 0

calcular()

}

carregarFuncionario()

/* ============================= */
/* CALCULO CLT BASICO */
/* ============================= */

function calcular(){

let salario = Number(document.getElementById("salario_base").value || 0)
let extras = Number(document.getElementById("horas_extras").value || 0)
let noturno = Number(document.getElementById("noturno").value || 0)
let insal = Number(document.getElementById("insalubridade").value || 0)
let faltas = Number(document.getElementById("faltas").value || 0)

let desconto_faltas = (salario / 30) * faltas

let total_vencimentos = salario + extras + noturno + insal

/* INSS aproximado */
let inss = total_vencimentos * 0.08

/* FGTS */
let fgts = total_vencimentos * 0.08

let liquido = total_vencimentos - inss - desconto_faltas

document.getElementById("r_salario").innerText = salario.toFixed(2)
document.getElementById("r_vencimentos").innerText = total_vencimentos.toFixed(2)
document.getElementById("r_inss").innerText = inss.toFixed(2)
document.getElementById("r_fgts").innerText = fgts.toFixed(2)
document.getElementById("r_liquido").innerText = liquido.toFixed(2)

}

/* ============================= */
/* GERAR PDF */
/* ============================= */

function gerarPDF(){

    const mes = document.getElementById("mes").value
    const ano = document.getElementById("ano").value

    window.open(
        `contracheque_modelo.html?uid=${uid}&mes=${mes}&ano=${ano}`,
        "_blank"
    )
}


/* ============================= */
/* VOLTAR */
/* ============================= */

function voltar(){
window.history.back()
}

</script>

</body>
</html>
