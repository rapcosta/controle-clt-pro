<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Gerar Contracheque</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
.container{
max-width:600px;
margin:auto;
text-align:center;
}

input{
width:100%;
padding:10px;
margin:5px 0;
border-radius:6px;
border:none;
}

label{
display:block;
margin-top:10px;
font-weight:bold;
}

.resumo{
margin-top:20px;
padding:15px;
background:#111;
border-radius:8px;
}
</style>
</head>

<body>

<div class="container" id="area-contracheque">

<h1>Gerar Contracheque</h1>

<h3 id="nomeFuncionario"></h3>

<hr>

<label>Mês</label>
<input id="mes" value="01">

<label>Ano</label>
<input id="ano" value="2026">

<hr>

<h3>Vencimentos</h3>

<label>Salário Base (R$)</label>
<input id="salario_base">

<label>Horas Extras (R$)</label>
<input id="horas_extras" value="0">

<label>Adicional Noturno (R$)</label>
<input id="noturno" value="0">

<label>Insalubridade (R$)</label>
<input id="insalubridade" value="0">

<hr>

<h3>Descontos</h3>

<label>Faltas (dias)</label>
<input id="faltas" value="0">

<label>Dependentes IRRF</label>
<input id="dependentes" value="0">

<hr>

<button onclick="calcular()">Calcular</button>
<button onclick="gerarPDF()">Gerar PDF</button>
<button onclick="voltar()">Voltar</button>

<div class="resumo">
<h3>Resumo do cálculo</h3>

<p>Salário Base: R$ <span id="r_salario">0</span></p>
<p>Total Vencimentos: R$ <span id="r_vencimentos">0</span></p>
<p>INSS: R$ <span id="r_inss">0</span></p>
<p>FGTS: R$ <span id="r_fgts">0</span></p>
<p>Líquido: R$ <span id="r_liquido">0</span></p>
</div>

</div>

<script>

/* ============================= */
/* PEGAR UID */
/* ============================= */

const params = new URLSearchParams(window.location.search)
const uid = params.get("uid")

/* ============================= */
/* CARREGAR FUNCIONARIO */
/* ============================= */

async function carregarFuncionario(){

const {data,error} = await supabaseClient
.from("funcionarios")
.select("*")
.eq("uid", uid)
.single()

if(error){
alert("Erro ao carregar funcionário")
return
}

document.getElementById("nomeFuncionario").innerText =
data.nome + " | CPF: " + data.cpf

document.getElementById("salario_base").value = data.salario || 0

calcular()

}

carregarFuncionario()

/* ============================= */
/* CALCULO CLT BASICO */
/* ============================= */

function calcular(){

let salario = Number(document.getElementById("salario_base").value || 0)
let extras = Number(document.getElementById("horas_extras").value || 0)
let noturno = Number(document.getElementById("noturno").value || 0)
let insal = Number(document.getElementById("insalubridade").value || 0)
let faltas = Number(document.getElementById("faltas").value || 0)

let desconto_faltas = (salario / 30) * faltas

let total_vencimentos = salario + extras + noturno + insal

/* INSS aproximado */
let inss = total_vencimentos * 0.08

/* FGTS */
let fgts = total_vencimentos * 0.08

let liquido = total_vencimentos - inss - desconto_faltas

document.getElementById("r_salario").innerText = salario.toFixed(2)
document.getElementById("r_vencimentos").innerText = total_vencimentos.toFixed(2)
document.getElementById("r_inss").innerText = inss.toFixed(2)
document.getElementById("r_fgts").innerText = fgts.toFixed(2)
document.getElementById("r_liquido").innerText = liquido.toFixed(2)

}

/* ============================= */
/* GERAR PDF */
/* ============================= */

function gerarPDF(){

calcular()

const elemento = document.getElementById("area-contracheque")

html2pdf().set({
margin:10,
filename:"contracheque.pdf",
html2canvas:{scale:2},
jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}
}).from(elemento).save()

}

/* ============================= */
/* VOLTAR */
/* ============================= */

function voltar(){
window.history.back()
}

</script>

</body>
</html>
